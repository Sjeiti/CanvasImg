/*
* CANVASIMG 0.5.7
* Copyright (c) 2010 Ron Valstar http://www.sjeiti.com/
*
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*/
if(!this.CIMG){var CIMG=function(){try{TWEEN}catch(d){alert("You need to include Sole's tween.js");return}var f=!!document.createElement("canvas").getContext;if(!f){trace("The canvas element is not supported in this browser.")}var b={transition:{},constructor:null,id:"CanvasImg",version:"0.5.7",defaults:{globalScale:1,toDataURL:false,tweenType:TWEEN.Easing.Linear.EaseNone,transition:null,time:1000,frameRate:42,exists:"ignore"},toString:function(){return"[object CANVASIMG]"}};var c={};function e(l){var m=document.createElement("canvas");m.width=l.width;m.height=l.height;return m}function h(o,n){if(n.constructor===String){var m=document.createElement("img");m.setAttribute("src",n);m.onload=function(r){h(o,m)};return}var q=o.getContext("2d");var l=q.canvas.width;var p=q.canvas.height;q.drawImage(n,0,0,l,p);return q}var a=0;function k(m){a++;var l="cimgid"+a;m.setAttribute("id",l);return l}function g(m,l){switch(m.constructor){case HTMLCanvasElement:case CanvasRenderingContext2D:break;case HTMLImageElement:m.setAttribute("src",l.canvas.toDataURL("image/jpeg"));break;default:m.style.backgroundImage="url("+l.canvas.toDataURL("image/jpeg")+")"}}function j(o,l,q){var m=o.getAttribute("id");var n=c[m];if(n.timer){clearInterval(n.timer);delete n.timer}if(n.canvas!==undefined){switch(o.constructor){case HTMLImageElement:if(l){o.setAttribute("src",n.toImg.getAttribute("src"))}else{g(o,n)}if(!n.toDataURL){o.style.display=n.canvas.style.display;n.canvas.parentNode.removeChild(n.canvas)}break;case HTMLCanvasElement:case CanvasRenderingContext2D:if(l){h(n.canvas,n.toImg)}break;default:if(l){o.style.backgroundImage="url("+n.toImg.getAttribute("src")+")"}else{g(o,n)}if(!n.toDataURL){n.canvas.parentNode.removeChild(n.canvas)}}}if(q&&n.callback!==undefined){n.callback()}delete c[m];return n}function i(N,y,u,K,v,w){u=u===undefined?b.defaults.time:u;K=K||b.defaults.transition;v=v||b.defaults.tweenType;if(!f){var L=y.constructor===String?y:y.getAttribute("src");switch(N.constructor){case HTMLImageElement:N.setAttribute("src",L);break;default:N.style.backgroundImage="url("+L+")"}if(w.callback!==undefined){w.callback()}return false}if(N.constructor!==HTMLCanvasElement&&N.constructor!==CanvasRenderingContext2D){var t;if(N.constructor===HTMLImageElement){t=N.getAttribute("src")}else{var n=N.style.backgroundImage;if(n.substr(4,1)==='"'){t=n.substring(5,n.length-2)}else{t=n.substring(4,n.length-1)}}var p;if(y.constructor===String){p=y}else{p=y.getAttribute("src")}if(t==p){if(w.callback!==undefined){w.callback()}return false}}var q={extend:function(P){for(var O in P){if(!this.hasOwnProperty(O)){this[O]=P[O]}}return this}}.extend(w).extend(b.defaults);var x=N.getAttribute("id")||k(N);if(c[x]===undefined){c[x]=q}else{switch(q.exists){case"ignore":return false;break;case"append":return false;break;case"replace":var m=j(N,false,true);var E=document.createElement("img");E.onload=function(O){i(N,y,u,K,v,q)};g(E,m);N.style.width=m.w+"px";N.style.height=m.h+"px";return false;break}}var s;var z;if(y.constructor===String){j(N);var A=document.createElement("img");A.setAttribute("src",y);A.onload=function(O){i(N,A,u,K,v,q)};return true}switch(N.constructor){case HTMLImageElement:s=e(N);z=h(s,N);if(!q.toDataURL){N.parentNode.insertBefore(s,N);for(var J=0;J<N.style.length;J++){var o=N.style[J].replace("-value","");s.style.setProperty(o,N.style.getPropertyValue(o),null)}N.style.display="none"}break;case HTMLCanvasElement:s=N;z=N.getContext("2d");break;case CanvasRenderingContext2D:s=N.canvas;z=N;break;default:if(q.backgroundImageContext){s=q.backgroundImageContext.canvas;z=q.backgroundImageContext}else{var D=document.createElement("img");var H;var n=N.style.backgroundImage;if(n===""){trace("canvasImg warning: The targets background image should be set inline for it to work properly.");H=y.getAttribute("src")}else{if(n.substr(4,1)==='"'){H=n.substring(5,n.length-2)}else{H=n.substring(4,n.length-1)}}D.setAttribute("src",H);D.onload=function(Q){if(N.style.position!=="absolute"){N.style.position="relative"}s=e(D);if(!q.toDataURL){s.style.position="absolute";s.style.top="0px";s.style.left="0px";s.style.zIndex=0;for(var O=0;O<N.children.length;O++){var P=N.children[0];if(P.style.position!=="absolute"){P.style.position="relative"}if(P.style.zIndex===""){P.style.zIndex=O+1}}if(N.children.length===0){N.appendChild(s)}else{N.insertBefore(s,N.children[0])}}z=h(s,D);q.backgroundImageContext=z;i(N,y,u,K,v,q)};j(N);return true}break}var M=s.width;var r=s.height;var I=document.createElement("canvas");I.width=M;I.height=r;var l=I.getContext("2d");l.drawImage(s,0,0,M,r);var C=document.createElement("canvas");C.width=M;C.height=r;var B=C.getContext("2d");y;B.drawImage(y,0,0,M,r);var G=document.createElement("canvas");G.width=M;G.height=r;var F=G.getContext("2d");q.toImg=y;q.r=Math.ceil(0.5*Math.sqrt(M*M+r*r));q.w=s.width;q.h=s.height;q.seed=Math.round(2147483647*Math.random());q.canvas=s;q.context=z;q.canvasFrom=I;q.canvasTo=C;q.contextTmp=F;q.apply=function(P,O){if(O){this.context.clearRect(0,0,this.w,this.h)}this.contextTmp.globalCompositeOperation=P||"source-in";this.contextTmp.fillStyle=this.contextTmp.createPattern(O?this.canvasFrom:this.canvasTo,"no-repeat");this.contextTmp.fillRect(0,0,this.w,this.h);this.contextTmp.globalCompositeOperation="source-over";this.context.drawImage(this.contextTmp.canvas,0,0,this.w,this.h);if(!O){this.contextTmp.clearRect(0,0,this.w,this.h)}return this};if(K.init){K.init(q)}q.tstart=new Date().getTime();q.timer=setInterval(function(){var O=new Date().getTime();var P=(O-q.tstart)/u;q.t=v(P);if(P<1){if(K.from){K.from(q)}else{z.drawImage(I,0,0,M,r)}if(K.to){K.to(q)}else{z.drawImage(C,0,0,M,r)}if(q.toDataURL){g(N,q)}}else{if(P>=1){j(N,true,true)}}},q.frameRate);return true}b.set=h;b.tween=i;return b}();CIMG.defaults.transition=CIMG.transition.fade=function(a){return{to:function(b){b.context.globalAlpha=b.t;b.context.drawImage(b.canvasTo,0,0,b.w,b.h);b.context.globalAlpha=1}}}();CIMG.transition.zoom=function(){return{init:function(a){a.extend({scale:5})},from:function(b){var a=1+b.scale*b.t;b.context.drawImage(b.canvasFrom,-0.5*(a-1)*b.w,-0.5*(a-1)*b.h,a*b.w,a*b.h)},to:function(b){b.context.globalAlpha=b.t;var a=1+b.scale*(1-b.t);b.context.drawImage(b.canvasTo,-0.5*(a-1)*b.w,-0.5*(a-1)*b.h,a*b.w,a*b.h);b.context.globalAlpha=1}}}();CIMG.transition.wipe=function(a){return{init:function(b){b.extend({direction:"r"})},to:function(b){switch(b.direction){case"t":b.context.drawImage(b.canvasTo,0,-(1-b.t)*b.h,b.w,b.h);break;case"b":b.context.drawImage(b.canvasTo,0,(1-b.t)*b.h,b.w,b.h);break;case"l":b.context.drawImage(b.canvasTo,-(1-b.t)*b.w,0,b.w,b.h);break;case"r":b.context.drawImage(b.canvasTo,(1-b.t)*b.w,0,b.w,b.h);break}}}}();CIMG.transition.fold=function(a){return{init:function(b){b.extend({direction:"r",linear:false,shadow:0.3})},from:function(c){var b=c.direction==="l"||c.direction==="t";c.context.drawImage(b?c.canvasTo:c.canvasFrom,0,0,c.w,c.h,0,0,c.w,c.h);switch(c.direction){case"t":case"b":c.context.drawImage(b?c.canvasFrom:c.canvasTo,0,c.h/2,c.w,c.h/2,0,c.h/2,c.w,c.h/2);break;case"l":case"r":c.context.drawImage(b?c.canvasFrom:c.canvasTo,c.w/2,0,c.w/2,c.h,c.w/2,0,c.w/2,c.h);break}},to:function(b){var c=b.direction==="l"||b.direction==="r";var j=b.direction==="l"||b.direction==="t";var m=j?1-b.t:b.t;var g=b.linear?m:m<0.5;var d=0.5*(Math.sin((m-0.5)*Math.PI)+1);var k;var i;var l;var f;switch(b.direction){case"t":case"b":k=0;i=(g?0.5:1-d)*b.h;l=b.w;f=Math.abs(0.5-d)*b.h;break;case"l":case"r":k=(g?0.5:1-d)*b.w;i=0;l=Math.abs(0.5-d)*b.w;f=b.h;break}b.context.drawImage(g!==j?b.canvasFrom:b.canvasTo,(c?1:0)*(g?0.5:0)*b.w,(c?0:1)*(g?0.5:0)*b.h,(c?0.5:1)*b.w,(c?1:0.5)*b.h,k,i,l,f);if(b.shadow!==0){var e=Math.min(Math.max(b.shadow*(0.5-Math.abs(0.5-d)),1),0);b.context.fillStyle=g===c?"rgba(0,0,0,"+e+")":"rgba(255,255,255,"+e+")";b.context.fillRect(k,i,l,f)}}}}();CIMG.transition.flip=function(a){return{init:function(b){b.extend({vertical:false,linear:false,shadow:0.3})},from:function(b){b.context.clearRect(0,0,b.w,b.h)},to:function(b){var g=b.t<0.5;var c=0.5*(Math.sin((b.t-0.5)*Math.PI)+1);var k=(b.linear?b.t:c)*(g?1:-1)+(g?0:1);var i=(b.vertical?0:b.t)*b.w;var f=(b.vertical?b.t:0)*b.h;var j=(b.vertical?1:1-b.t*2)*b.w;var e=(b.vertical?1-b.t*2:1)*b.h;b.context.drawImage(g?b.canvasFrom:b.canvasTo,i,f,j,e);if(b.shadow>0){var d=b.shadow*(0.5-Math.abs(0.5-c));b.context.fillStyle=g===b.vertical?"rgba(0,0,0,"+d+")":"rgba(255,255,255,"+d+")";b.context.fillRect(i,f,j,e)}}}}();CIMG.transition.pageflip=function(a){return{init:function(b){b.extend({shadow:0.3})},from:function(b){b.context.clearRect(0,0,b.w,b.h)},to:function(c){var b=(1-c.t)*c.w;var d=0.5*Math.sin(c.t*Math.PI)*c.h;c.context.beginPath();c.context.lineTo(c.w,0);c.context.moveTo(b,d);c.context.lineWidth=1;c.context.strokeStyle="#000";c.context.stroke();c.context.closePath();c.context.fillRect(b,d,2,2)}}}();CIMG.transition.circle=function(a){return{init:function(b){b.extend({grow:true,fade:100})},to:function(e){var b=e.w/2;var f=e.h/2;var d=Math.max(0,(e.grow?e.t:1-e.t)*(e.r+e.fade));e.contextTmp.beginPath();if(e.fade===0){e.contextTmp.fillStyle="#f00"}else{var c=e.contextTmp.createRadialGradient(b,f,0,b,f,d);c.addColorStop(e.r/(e.r+e.fade),"#000");c.addColorStop(1,"rgba(0,0,0,0)");e.contextTmp.fillStyle=c}e.contextTmp.arc(b,f,d,0,2*Math.PI,false);e.contextTmp.closePath();e.contextTmp.fill();e.apply(e.grow?"source-in":"source-out")}}}();CIMG.transition.square=function(a){return{init:function(b){b.extend({grow:true})},to:function(f){var d=f.grow?f.t:1-f.t;var c=d*f.w;var e=d*f.h;var b=(f.w-c)/2;var g=(f.h-e)/2;f.contextTmp.beginPath();f.contextTmp.fillStyle="#f00";f.contextTmp.fillRect(b,g,c,e);f.contextTmp.closePath();f.contextTmp.fill();f.apply(f.grow?"source-in":"source-out")}}}();CIMG.transition.clock=function(a){return{init:function(b){b.extend({clockwise:true,startAngle:0})},to:function(c){var b=(c.startAngle/180-0.5)*Math.PI;c.contextTmp.beginPath();c.contextTmp.moveTo(Math.floor(c.w/2),Math.floor(c.h/2));c.contextTmp.arc(Math.floor(c.w/2),Math.floor(c.h/2),c.r,b,b+(c.clockwise?1:-1)*(c.t)*2*Math.PI,false);c.contextTmp.closePath();c.contextTmp.fill();c.apply(c.clockwise?"source-in":"source-out")}}}();CIMG.transition.wave=function(a){return{to:function(c){var b=(1-2*c.t)*c.w;c.contextTmp.beginPath();c.contextTmp.moveTo(b,c.h);c.contextTmp.bezierCurveTo(b+c.w*0.5,c.h,b+c.w*0.5,0,b+c.w,0);c.contextTmp.lineTo(b+c.w*2,0);c.contextTmp.lineTo(b+c.w*2,c.h);c.contextTmp.closePath();c.contextTmp.fill();c.apply()}}}();CIMG.transition.blinds=function(a){return{init:function(b){if(b.extend({number:16,even:0.9,rotation:0.2*Math.PI})){}},to:function(e){var b=2*e.r/e.number;e.contextTmp.translate(e.w/2,e.h/2);e.contextTmp.rotate(e.rotation);for(var c=0;c<e.number;c++){var d=Math.min(Math.max(e.even*(e.t)+(1-e.even)*((e.t)*e.number-c),0),1);e.contextTmp.fillRect(-e.r,-e.r+Math.round(b/2+c*b-d*b/2),2*e.r,Math.ceil(d*(b+0.1)))}e.contextTmp.rotate(-e.rotation);e.contextTmp.translate(-e.w/2,-e.h/2);e.apply()}}}();CIMG.transition.particles=function(a){return{init:function(n){n.extend({number:128,scale:1,character:"*",font:"Verdana"});var A=Math.floor(0.6*n.h);n.contextTmp.font=A+"px "+n.font;n.contextTmp.textBaseline="middle";n.mTCnv=document.createElement("canvas");n.mTCnv.width=n.w;n.mTCnv.height=n.h;n.mTCtx=n.mTCnv.getContext("2d");n.mTCtx.font=n.contextTmp.font;n.mTCtx.textBaseline="middle";n.mTCtx.fillText(n.character,n.w/4,n.h/3);var s=8;var t=[];var l;for(var v=0;v<2;v++){l=n.mTCnv;var h=v===0;for(var x=s;x>=1;x/=2){var o=document.createElement("canvas");o.width=h?n.w:x;o.height=h?x:n.h;var q=o.getContext("2d");q.drawImage(l,0,0,h?n.w:x,h?x:n.h);if(x>1){l=o}else{var u=q.getImageData(0,0,h?n.w:x,h?x:n.h);var g=undefined;var b=undefined;for(var w=0;w<u.data.length/4;w++){var f=u.data[w*4+3];if(f!==0&&g===undefined){g=Math.max(0,w-1)}if(f===0&&b===undefined){b=w}else{if(f!==0){b=undefined}}}t.push(g);t.push(b)}}}var z=0;var d=t[0]||0;var c=t[2]||0;var e=Math.max(1,(t[1]-t[0])||1);var m=Math.max(1,(t[3]-t[2])||1);var y=document.createElement("canvas");y.width=e+2*z;y.height=m+2*z;var r=y.getContext("2d");r.drawImage(n.mTCnv,d,c,e,m,z,z,e,m);n.mTCnv=y},to:function(j){var g=j.number;Prng.seed=j.seed;for(var f=0;f<g;f++){var e=j.w*(g===1?0.5:Prng.random());var d=j.h*(g===1?0.5:Prng.random());var c=Math.max(0,(j.t)*j.r/Math.sqrt(g)*1.5);var b=c*j.mTCnv.width*0.02*j.scale;var h=c*j.mTCnv.height*0.02*j.scale;e-=b/2;d-=h/2;j.contextTmp.drawImage(j.mTCnv,e,d,b,h)}j.apply()}}}();CIMG.transition.noise=function(a){return{init:function(c){Prng.seed=c.seed;c.noise=[];for(var b=0;b<c.w*c.h;b++){c.noise.push(Prng.random())}c.contextTmp.fillRect(0,0,c.w,c.h);c.imgdata=c.contextTmp.getImageData(0,0,c.w,c.h);c.pixels=c.imgdata.data},to:function(c){for(var b=0;b<c.pixels.length/4;b++){c.pixels[4*b+3]=c.noise[b]>c.t?0:255}c.contextTmp.putImageData(c.imgdata,0,0);c.apply()}}}();CIMG.transition.simplexNoise=function(a){return{init:function(g){try{PerlinSimplex}catch(f){alert("You need to include PerlinSimplex.js");return}g.extend({scaleX:0.02,scaleY:0.02,fade:0.3});Prng.seed=g.seed;g.noise=[];var c=Prng.rnd();var e=Prng.rnd();for(var d=0;d<g.w*g.h;d++){var b=c+g.scaleX*(d%g.w);var h=e+g.scaleY*Math.floor(d/g.w);g.noise.push(PerlinSimplex.noise(b,h))}g.contextTmp.fillRect(0,0,g.w,g.h);g.imgdata=g.contextTmp.getImageData(0,0,g.w,g.h);g.pixels=g.imgdata.data},to:function(d){for(var c=0;c<d.pixels.length/4;c++){var b=-0.5*d.fade+d.t*(1+d.fade);d.pixels[4*c+3]=255*Math.min(Math.max((b-(d.noise[c]-0.5*d.fade))*(1/d.fade),0),1)}d.contextTmp.putImageData(d.imgdata,0,0);d.apply()}}}();CIMG.transition.drip=function(a){return{init:function(g){try{PerlinSimplex}catch(f){alert("You need to include PerlinSimplex.js");return}g.extend({scaleX:0.02,scaleY:0.0002,fade:0.3});g.contextTmp.fillRect(0,0,g.w,g.h);g.imgdata=g.contextTmp.getImageData(0,0,g.w,g.h);g.pixels=g.imgdata.data;g.noise=[];Prng.seed=g.seed;var c=Prng.rnd();var e=Prng.rnd();for(var d=0;d<g.w*g.h;d++){var b=d%g.w;var j=Math.floor(d/g.w);var h=c+g.scaleX*b;g.noise.push((j/g.h)*PerlinSimplex.noise(h))}},to:function(d){for(var c=0;c<d.pixels.length/4;c++){var b=-0.5*d.fade+d.t*(1+d.fade);d.pixels[4*c+3]=255*Math.min(Math.max((b-(d.noise[c]-0.5*d.fade))*(1/d.fade),0),1)}d.contextTmp.putImageData(d.imgdata,0,0);d.apply()}}}();CANVASIMG=CIMG}if(!this.Prng){var Prng=function(){var c=2147483647;var a=function(d){if(arguments.length){b.seed=arguments[0]}b.seed=b.seed*16807%c;return b.seed};var b={seed:123,rnd:a,random:function(d){if(arguments.length){b.seed=arguments[0]}return a()/c}};return b}()}if(!this.trace){function trace(a){if(window.console&&window.console.log){if(typeof(a)=="string"){window.console.log(a)}else{for(var b in a){window.console.log(b+":\t"+String(a[b]).split("\n")[0])}}}}}Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]===b){return a}}return -1};